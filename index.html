<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>POWERAUTO.AI</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    font-size: 1.8rem;
    font-weight: 600;
    color: #38bdf8;
    margin-top: 40px;
    text-align: center;
  }

  .container {
    background: #1e293b;
    padding: 24px 32px;
    border-radius: 16px;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
    width: 100%;
    max-width: 800px;
    margin-top: 20px;
    box-sizing: border-box;
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #a5b4fc;
  }

  .chat-style-input {
    display: flex;
    align-items: center;
    background: #0f172a;
    border: 1px solid #475569;
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 16px;
    position: relative;
  }

  .chat-style-input input[type="url"] {
    flex: 1;
    padding: 12px 16px;
    border: none;
    background: transparent;
    color: #f1f5f9;
    font-size: 1rem;
    outline: none;
  }

  .chat-style-input button {
    padding: 0 12px;
    background: #1e293b;
    border: none;
    cursor: pointer;
    color: #38bdf8;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .file-count {
    position: absolute;
    right: 50px;
    top: 50%;
    transform: translateY(-50%);
    background: #3b82f6;
    color: white;
    font-size: 0.8rem;
    padding: 2px 8px;
    border-radius: 12px;
    font-weight: 500;
    display: none;
  }

  textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #475569;
    border-radius: 8px;
    background: #0f172a;
    color: #f1f5f9;
    margin-bottom: 16px;
    transition: border-color 0.3s;
  }

  textarea:focus {
    border-color: #38bdf8;
    outline: none;
  }

  button#btnGerar {
    background: linear-gradient(90deg, #06b6d4, #3b82f6);
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s, opacity 0.2s;
    width: 100%;
  }

  button#btnGerar:hover {
    transform: scale(1.03);
    opacity: 0.9;
  }

  #saida {
    margin-top: 24px;
  }

  .chart-card {
    background: #0f172a;
    padding: 16px;
    margin: 20px 0;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(56, 189, 248, 0.15);
    animation: fadeIn 0.6s ease;
  }

  canvas {
    width: 100% !important;
    height: 300px !important;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  input[type="file"] {
    display: none;
  }
</style>
</head>
<body>
<h1>POWERAUTO.AI</h1>

<div class="container">
  <label>Dados (URL ou arquivo local):</label>
  <div class="chat-style-input">
    <input type="url" id="jsonUrl" placeholder="Cole a URL ou selecione arquivos...">
    <span class="file-count" id="fileCount">0 arquivos</span>
    <button type="button" id="btnEscolherArquivo">üìÅ</button>
    <input type="file" id="fileInput" multiple>
  </div>

  <label>Prompt adicional:</label>
  <textarea id="promptExtra" rows="3" placeholder="(opcional) Instru√ß√µes adicionais √† IA..."></textarea>

  <button id="btnGerar">Gerar gr√°ficos com IA</button>

  <div id="saida"></div>
</div>

<script>
const GEMINI_API_KEY = "AIzaSyDJLuHCpIDVOzXIzeLVg9OOp2vF2PnSlWg"; 
const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent";

const fileInput = document.getElementById("fileInput");
const fileCount = document.getElementById("fileCount");
const btnEscolherArquivo = document.getElementById("btnEscolherArquivo");

btnEscolherArquivo.onclick = () => fileInput.click();

fileInput.addEventListener("change", () => {
  const count = fileInput.files.length;
  if (count > 0) {
    fileCount.textContent = count + (count === 1 ? " arquivo" : " arquivos");
    fileCount.style.display = "inline-block";
  } else {
    fileCount.style.display = "none";
  }
});

async function readFilesAsText(files) {
  const results = [];
  for (let file of files) {
    const text = await file.text();
    results.push({name: file.name, content: text});
  }
  return results;
}

document.getElementById("btnGerar").onclick = async () => {
  const url = document.getElementById("jsonUrl").value.trim();
  const files = fileInput.files;
  const extra = document.getElementById("promptExtra").value.trim();
  const saida = document.getElementById("saida");
  saida.innerHTML = `<p>üîÑ Carregando dados e consultando IA...</p>`;

  try {
    let dataText = "";

    if (files.length > 0) {
      const fileContents = await readFilesAsText(files);
      fileContents.forEach(f => {
        dataText += `\nArquivo: ${f.name}\n${f.content}\n`;
      });
    } else if (url) {
      const response = await fetch(url);
      dataText = await response.text();
    } else {
      saida.innerHTML = `<span style="color:#f87171">Selecione arquivos ou informe uma URL.</span>`;
      return;
    }

    const prompt = `
Voc√™ √© um assistente especializado em visualiza√ß√£o de dados.
Com base nos dados abaixo (texto puro de arquivos ou JSON), gere um ou mais gr√°ficos relevantes em formato JSON puro (sem formata√ß√£o e n√£o escreva nada al√©m do JSON):
{
  "charts": [
    {
      "id": "grafico1",
      "type": "bar",
      "title": "T√≠tulo do gr√°fico",
      "data": {"labels": [], "datasets": [{"label": "Exemplo", "data": []}]},
      "description": "Breve explica√ß√£o do que o gr√°fico mostra."
    }
  ]
}
${extra ? "Instru√ß√µes extras: " + extra : ""}
Dados fornecidos:
${dataText.slice(0, 10000)}
`;

    const res = await fetch(`${GEMINI_URL}?key=${GEMINI_API_KEY}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: prompt }] }] })
    });

    const result = await res.json();
    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sem resposta da IA.";

    const start = text.indexOf("{");
    const end = text.lastIndexOf("}");
    const jsonStr = text.slice(start, end + 1);
    const chartsData = JSON.parse(jsonStr);

    saida.innerHTML = "";

    if (chartsData.charts) {
      chartsData.charts.forEach((ch, i) => {
        const card = document.createElement("div");
        card.className = "chart-card";
        card.innerHTML = `
          <h3 style="color:#38bdf8">${ch.title}</h3>
          <p style="color:#cbd5e1">${ch.description}</p>
          <canvas id="c${i}"></canvas>
        `;
        saida.appendChild(card);

        const ctx = document.getElementById("c" + i).getContext("2d");
        new Chart(ctx, {
          type: ch.type || "bar",
          data: ch.data,
          options: {
            responsive: true,
            plugins: {
              legend: { labels: { color: "#e2e8f0" } },
            },
            scales: {
              x: { ticks: { color: "#94a3b8" } },
              y: { ticks: { color: "#94a3b8" } },
            }
          }
        });
      });
    }
  } catch (err) {
    saida.innerHTML = `<span style="color:#f87171">Erro: ${err.message}</span>`;
  }
};
</script>
</body>
</html>
